#!perl

use 5.010;
use strict;
use warnings;
use Log::Any '$log';

use Perinci::CmdLine;

# VERSION

our %SPEC;

$SPEC{generate_usage} = {
    v => 1.1,
    args => {
        url => {
            summary => 'Riap URL to function, e.g. /Git/Bunch/backup_bunch',
            req => 1,
            pos => 0,
            schema => 'str*',
        },
    },
};
sub generate_usage {
    my %args = @_;
    # XXX schema
    my $url = $args{url} or return [400, "Please specify url"];
    #$log->errorf("TMP: url=%s", $url);

    my $progname = $url; $progname =~ s!.+/!!;
    my $cmd = Perinci::CmdLine->new(
        log_any_app => 0,
        program_name => $progname,
        url => $url,
    );
    $cmd->run_help;
    [200, "OK", ''];
}

my $cmd = Perinci::CmdLine->new(
    log_any_app => 0, # speed up start-up
    url => '/main/generate_usage',
);
delete $cmd->common_opts->{format};
delete $cmd->common_opts->{format_options};
$cmd->run;

# ABSTRACT: Display command-line usage of a Riap function
# PODNAME: peri-func-usage

=head1 SYNOPSIS

From command-line:

 % peri-func-usage /Some/Module/somefunc
 % peri-func-usage --help


=head1 DESCRIPTION

=cut
